@model Fitnesstracker.ViewModels.BodyweightSummaryViewModel

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
    <script src="~/js/Bodyweight/summary.js"></script>
}

@{
    ViewData["Title"] = "Bodyweight";



    string FormatWeight(double D)

    {

        if (D == -0)

            D = 0;

        return $"{Math.Round(D, 2):+0.00;-0.00}kg";

    }
}

<div class="container my-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">My Bodyweight</h2>
        <a asp-controller="Bodyweight" asp-action="EditRecords" class="btn btn__primary"><i class="bi bi-plus-circle"></i> Add Bodyweights</a>
    </div>

    @if (Model.MostRecentRecord == null || Model.MostRecentRecord.Date != DateTime.Today)

    {
        <div class="alert alert-info">
            <h5>Add Today's Weight</h5>
            <form asp-action="AddTodayWeight" method="post">
                <div class="input-group">
                    <input type="number" min="0" max="200" name="Weight" step="0.1" class="form-control" required />
                    <div class="input-group-append">
                        <input type="submit" value="Save" class="btn btn__primary" />
                    </div>
                </div>
            </form>
        </div>
    }

    <div class="row">
        <!-- Most Recent Bodyweight -->
        <div class="col-md-3 mb-3">
            <div class="card text-center">
                <div class="card-header">
                    <h5>Most Recent Bodyweight</h5>
                </div>
                <div class="card-body">
                    <h4>@(Model.MostRecentRecord?.Weight.ToString("F2") ?? "0")kg</h4>
                    <p>@Model.MostRecentRecord?.Date.ToString("d")</p>
                </div>
            </div>
        </div>

        <!-- This Week's Progress -->
        <div class="col-md-3 mb-3">
            <div class="card text-center">
                <div class="card-header">
                    <h5>This Week's Progress</h5>
                </div>
                <div class="card-body">
                    <h4>@FormatWeight(Model.CurrentWeekProgress)</h4>
                </div>
            </div>
        </div>

        <!-- Current Month's Progress -->
        <div class="col-md-3 mb-3">
            <div class="card text-center">
                <div class="card-header">
                    <h5>Current Month's Progress</h5>
                </div>
                <div class="card-body">
                    <h4>@FormatWeight(Model.CurrentMonthProgress)</h4>
                </div>
            </div>
        </div>

        <!-- All Time Progress -->
        <div class="col-md-3 mb-3">
            <div class="card text-center">
                <div class="card-header">
                    <h5>All Time Progress</h5>
                </div>
                <div class="card-body">
                    <h4>@FormatWeight(Model.AllTimeProgress)</h4>
                </div>
            </div>
        </div>
    </div>

    <!-- Seconda riga di card -->
    <div class="row">
        <!-- Target Bodyweight -->
        <div class="col-md-3 mb-3">
            <div class="card text-center">
                <div class="card-header">
                    <h5>
                        Target Bodyweight
                        <button class="btn btn-link text-light float-right p-0" data-toggle="modal" data-target="#TargetModal">
                            <i class="bi bi-pencil-square"></i>
                        </button>
                    </h5>
                </div>
                <div class="card-body">
                    <h4 id="TargetWeight" data-target="@(Model.Target?.TargetWeight ?? 0)">
                        @(Model.Target?.TargetWeight.ToString("F2") ?? "0")kg
                    </h4>
                    <p>@Model.Target?.TargetDate.ToString("d")</p>
                </div>
            </div>
        </div>

        <!-- Distance to Target -->
        <div class="col-md-3 mb-3">
            <div class="card text-center">
                <div class="card-header">
                    <h5>Distance to Target</h5>
                </div>
                <div class="card-body">
                    <h4>@FormatWeight(Model.DistanceToTarget)</h4>
                </div>
            </div>
        </div>

        <!-- Daily Progress Needed -->
        <div class="col-md-3 mb-3">
            <div class="card text-center">
                <div class="card-header">
                    <h5>Daily Progress Needed</h5>
                </div>
                <div class="card-body">
                    <h4>@FormatWeight(Model.DailyProgressNeeded)</h4>
                </div>
            </div>
        </div>

        <!-- Weekly Progress Needed -->
        <div class="col-md-3 mb-3">
            <div class="card text-center">
                <div class="card-header">
                    <h5>Weekly Progress Needed</h5>
                </div>
                <div class="card-body">
                    <h4>@FormatWeight(Model.WeeklyProgressNeeded)</h4>
                </div>
            </div>
        </div>
    </div>

    <!-- Grafici -->
    <div class="row">
        <div class="col-md-6">
            <h3 class="text-center">This Week</h3>
            <canvas id="WeekGraph"></canvas>
        </div>
        <div class="col-md-6">
            <h3 class="text-center">This Month</h3>
            <canvas id="MonthGraph"></canvas>
        </div>
    </div>
</div>

<!-- Modal per Edit Target -->
<div class="modal fade" id="TargetModal" tabindex="-1" aria-labelledby="TargetModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content bg-dark text-light">
            <div class="modal-header">
                <h5 class="modal-title" id="TargetModalLabel">Edit Target</h5>
                <button type="button" class="close text-light" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form asp-controller="Bodyweight" asp-action="EditTarget" method="post">
                <div class="modal-body">
                    <div class="form-group">
                        <label>Weight</label>
                        <input class="form-control" name="TargetWeight" type="number" min="1" max="300" value="@Model.Target?.TargetWeight" required />
                    </div>
                    <div class="form-group">
                        <label>Target Date</label>
                        <input class="form-control" name="TargetDate" type="date" value="@Model.Target?.TargetDate.ToString("yyyy-MM-dd")" required />
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
                    <input type="submit" class="btn btn__primary" value="Save">
                </div>
            </form>
        </div>
    </div>
</div>
